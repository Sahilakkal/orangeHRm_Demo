import tkinter as tk
from tkinter import messagebox
from tensorflow.keras.models import load_model
from tensorflow.keras.preprocessing.sequence import pad_sequences
from tensorflow.keras.preprocessing.text import Tokenizer
from sklearn.preprocessing import LabelEncoder

# Load the tokenizer
tokenizer = Tokenizer()
tokenizer.fit_on_texts([''])  # Pass empty list to avoid an error, tokenizer will not be used for prediction

# Load the trained model
model = load_model('trained_model.h5')

# Load the label encoder
label_encoder = LabelEncoder()
label_encoder.classes_ = ['safe', 'vulnerable']  # Update with your actual class labels used during training

# Maximum length of code snippets
MAX_LENGTH = 100  # Update with the maximum length used during training

# Function to perform prediction
def predict():
    code = code_entry.get()

    # Preprocess the new code snippet
    code_sequence = tokenizer.texts_to_sequences([code])
    code_padded = pad_sequences(code_sequence, maxlen=MAX_LENGTH, padding='post')

    # Generate prediction
    prediction = model.predict(code_padded)
    predicted_class = label_encoder.inverse_transform([np.argmax(prediction)])[0]

    # Show prediction result
    messagebox.showinfo("Prediction Result", f"The code snippet is classified as: {predicted_class}")

# Create the Tkinter GUI window
window = tk.Tk()
window.title("Code Classification")
window.geometry("400x200")

# Create the code entry field
code_label = tk.Label(window, text="Enter code snippet:")
code_label.pack()
code_entry = tk.Entry(window)
code_entry.pack()

# Create the predict button
predict_button = tk.Button(window, text="Predict", command=predict)
predict_button.pack()

# Run the Tkinter event loop
window.mainloop()
